[gd_scene load_steps=5 format=3 uid="uid://ialjlqsl1sj5"]

[ext_resource type="PackedScene" uid="uid://c5cpdrfulu5f8" path="res://scenes/snap.tscn" id="1_jtt8e"]

[sub_resource type="GDScript" id="GDScript_jtt8e"]
script/source = "extends Node3D

@onready var boxtest: Node3D = $\".\"
@onready var snap: Area3D = $snap
var snap_nodes: Array[Node] = []
var obj2: Array[Node] = []
var current_snap_index: int = 0

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	for node in get_tree().get_nodes_in_group(\"snap\"):
		if node.get_parent() == self and node is Area3D:
			snap_nodes.append(node)
		
	 # Replace with function body.
func _unhandled_input(event: InputEvent) -> void:
	if event is InputEventMouseButton:
		if event.button_index == MOUSE_BUTTON_WHEEL_UP and event.pressed:
			if not snap_nodes.is_empty():
				current_snap_index = (current_snap_index + 1) % snap_nodes.size()
				print(\"Selected snap node:\", snap_nodes[current_snap_index])
			elif event.button_index == MOUSE_BUTTON_WHEEL_DOWN and event.pressed:
				if not snap_nodes.is_empty():
					current_snap_index = (current_snap_index - 1) % snap_nodes.size()
					print(\"Selected snap node:\", snap_nodes[current_snap_index])
					

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	pass
func shame(obj: Node3D):
	print(\"Shaming\", obj, \"onto\", self, \"using snap\", snap_nodes[current_snap_index] if not snap_nodes.is_empty() else null)
	
	var obj_snap = obj.get_node_or_null(\"snap\")
	var sticky = snap_nodes[current_snap_index]
	var target_transform = sticky.global_transform
	obj.global_transform = target_transform * obj_snap.transform.affine_inverse()
	var P = snap.global_position
	var R = Basis.from_euler(Vector3(PI, 0, 0))
	
	obj.global_position = P + R * (obj.global_position - P)
	obj.global_transform.basis = R * obj.global_transform.basis
"

[sub_resource type="CylinderMesh" id="CylinderMesh_jtt8e"]
top_radius = 5.0
bottom_radius = 5.0
height = 10.0

[sub_resource type="CylinderShape3D" id="CylinderShape3D_xhe3c"]
height = 1.0654297

[node name="cyltest" type="Node3D"]
script = SubResource("GDScript_jtt8e")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("CylinderMesh_jtt8e")

[node name="snap" parent="." instance=ExtResource("1_jtt8e")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.520898, 1.6529098, 0)

[node name="Area3D" type="Area3D" parent="."]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Area3D"]
transform = Transform3D(10, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0.0726099, 0)
shape = SubResource("CylinderShape3D_xhe3c")
